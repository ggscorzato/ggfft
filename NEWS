2013/7/9: first working version. Still very limited testing performed.
2013/7/16: now tested on a non-negligible set of cases. Still far from "releasable".