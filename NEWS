2013/7/9: first working version. Still very limited testing performed.